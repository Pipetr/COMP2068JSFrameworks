{{#section 'styles'}}
<link rel="stylesheet" href="/stylesheets/reports.css">
{{/section}}

<div class="container-fluid">
  <div class="reports-container">
    <div class="reports-header">
      <h1><i class="fas fa-chart-bar me-2"></i>Work Reports & Analytics</h1>
      <p class="mb-0">Visualize your work patterns and earnings</p>
    </div>

    {{#if error}}
      <div class="alert alert-danger" role="alert">
        {{error}}
      </div>
    {{/if}}

    <!-- Filters Section -->
    <div class="filters-section">
      <h5><i class="fas fa-filter me-2"></i>Filters</h5>
      <form id="filtersForm" class="filters-grid">
        <div class="form-group">
          <label for="startDate" class="form-label">Start Date</label>
          <input type="date" class="form-control" id="startDate" name="startDate" value="{{dateRange.start}}">
        </div>
        <div class="form-group">
          <label for="endDate" class="form-label">End Date</label>
          <input type="date" class="form-control" id="endDate" name="endDate" value="{{dateRange.end}}">
        </div>
        <div class="form-group">
          <label for="projectFilter" class="form-label">Project</label>
          <select class="form-control" id="projectFilter" name="projectFilter">
            <option value="all">All Projects</option>
            {{#each projects}}
              <option value="{{this._id}}">{{this.name}}</option>
            {{/each}}
          </select>
        </div>
        <div class="form-group">
          <button type="button" class="btn btn-primary" onclick="updateCharts()">
            <i class="fas fa-sync me-2"></i>Update Charts
          </button>
        </div>
      </form>
    </div>

    <!-- Summary Cards -->
    <div class="summary-cards">
      <div class="summary-card">
        <div class="icon text-primary">
          <i class="fas fa-clock"></i>
        </div>
        <div class="value" id="totalHours">{{totalHours}}</div>
        <div class="label">Total Hours</div>
      </div>
      <div class="summary-card">
        <div class="icon text-success">
          <i class="fas fa-dollar-sign"></i>
        </div>
        <div class="value" id="totalEarnings">${{totalEarnings}}</div>
        <div class="label">Net Earnings</div>
      </div>
      <div class="summary-card">
        <div class="icon text-info">
          <i class="fas fa-tasks"></i>
        </div>
        <div class="value" id="totalEntries">{{entriesCount}}</div>
        <div class="label">Work Entries</div>
      </div>
      <div class="summary-card">
        <div class="icon text-warning">
          <i class="fas fa-calculator"></i>
        </div>
        <div class="value" id="avgHourly">${{avgHourly}}</div>
        <div class="label">Avg Hourly Rate</div>
      </div>
    </div>

    <!-- Project Distribution Chart -->
    <div class="chart-container">
      <div class="chart-header">
        <div class="chart-title">
          <i class="fas fa-pie-chart me-2"></i>Hours by Project
        </div>
        <div class="chart-controls">
          <button type="button" class="btn btn-sm btn-outline-primary" onclick="toggleChartType('projectHours', 'pie')">
            <i class="fas fa-chart-pie"></i> Pie
          </button>
          <button type="button" class="btn btn-sm btn-outline-primary" onclick="toggleChartType('projectHours', 'bar')">
            <i class="fas fa-chart-bar"></i> Bar
          </button>
        </div>
      </div>
      <div class="chart-canvas">
        <canvas id="projectHoursChart"></canvas>
      </div>
    </div>

    <!-- Earnings Distribution Chart -->
    <div class="chart-container">
      <div class="chart-header">
        <div class="chart-title">
          <i class="fas fa-dollar-sign me-2"></i>Earnings by Project
        </div>
        <div class="chart-controls">
          <button type="button" class="btn btn-sm btn-outline-success" onclick="toggleChartType('projectEarnings', 'doughnut')">
            <i class="fas fa-chart-pie"></i> Doughnut
          </button>
          <button type="button" class="btn btn-sm btn-outline-success" onclick="toggleChartType('projectEarnings', 'bar')">
            <i class="fas fa-chart-bar"></i> Bar
          </button>
        </div>
      </div>
      <div class="chart-canvas">
        <canvas id="projectEarningsChart"></canvas>
      </div>
    </div>

    <!-- Time Series Chart -->
    <div class="chart-container">
      <div class="chart-header">
        <div class="chart-title">
          <i class="fas fa-chart-line me-2"></i>Daily Work Pattern
        </div>
        <div class="chart-controls">
          <button type="button" class="btn btn-sm btn-outline-info" onclick="toggleMetric('hours')">
            <i class="fas fa-clock"></i> Hours
          </button>
          <button type="button" class="btn btn-sm btn-outline-info" onclick="toggleMetric('earnings')">
            <i class="fas fa-dollar-sign"></i> Earnings
          </button>
        </div>
      </div>
      <div class="chart-canvas">
        <canvas id="timeSeriesChart"></canvas>
      </div>
    </div>
  </div>
</div>

{{#section 'scripts'}}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="/javascripts/reports.js"></script>
{{/section}}

<!-- Hidden data containers for client-side access -->
<script type="application/json" id="project-stats-data">{{projectStatsJson}}</script>
<script type="application/json" id="daily-stats-data">{{dailyStatsJson}}</script>
